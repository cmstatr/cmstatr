<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Plotting Composite Material Data • cmstatr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Plotting Composite Material Data">
<meta property="og:description" content="cmstatr">
<meta property="og:image" content="www.cmstatr.net/reference/figures/logo-240x278.png">
<meta property="og:image:alt" content="Statistical methods for composite material data: cmstatr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cmstatr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.6.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/adktest.html">Anderson-Darling k-Sample Test</a>
    </li>
    <li>
      <a href="../articles/cmstatr_Graphing.html">Plotting Composite Material Data</a>
    </li>
    <li>
      <a href="../articles/cmstatr_Tutorial.html">cmstatr Tutorial</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ComtekAdvancedStructures/cmstatr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="cmstatr_Graphing_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Plotting Composite Material Data</h1>
                        <h4 class="author">Ally Fraser</h4>
            
            <h4 class="date">2-May-2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ComtekAdvancedStructures/cmstatr/blob/master/vignettes/cmstatr_Graphing.Rmd"><code>vignettes/cmstatr_Graphing.Rmd</code></a></small>
      <div class="hidden name"><code>cmstatr_Graphing.Rmd</code></div>

    </div>

    
    
<p>This vignette demonstrates how to create some of the graphs commonly used when analyzing composite material data. Here, we rely on the <a href="https://ggplot2.tidyverse.org/"><code>ggplot2</code></a> package for graphing. This package can be loaded either on its own, or through the <code>tidyverse</code> meta-package, which also includes packages such as <code>dplyr</code> that we will also use.</p>
<p>We’ll need to load a few packages in order to proceed.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org">dplyr</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://tidyr.tidyverse.org">tidyr</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://www.cmstatr.net">cmstatr</a></span>)
</pre></div>
<p>Throughout this vignette, we’ll use one of the example data sets that comes with <code>cmstatr</code> and we’ll focus on the warp-tension data as an example. We’ll load the example data in a variable as follows. By default the condition will be in an arbitrary order, but throughout the visualization, we’ll want the conditions shown in a particular order (from coldest and driest to hottest and wettest). We can define the order of the conditions using the <code>ordered</code> function. For brevity, only the first few rows of the data set are displayed below.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="kw">dat</span> <span class="op">&lt;-</span> <span class="kw">carbon.fabric.2</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">test</span> <span class="op">==</span> <span class="st">"WT"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(condition = <span class="fu"><a href="https://rdrr.io/r/base/factor.html">ordered</a></span>(<span class="kw">condition</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"CTD"</span>, <span class="st">"RTD"</span>, <span class="st">"ETW"</span>, <span class="st">"ETW2"</span>)))

<span class="kw">dat</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fl">10</span>)
<span class="co">#&gt;    test condition batch thickness nplies strength modulus failure_mode</span>
<span class="co">#&gt; 1    WT       CTD     A     0.112     14  142.817   9.285          LAT</span>
<span class="co">#&gt; 2    WT       CTD     A     0.113     14  135.901   9.133          LAT</span>
<span class="co">#&gt; 3    WT       CTD     A     0.113     14  132.511   9.253          LAT</span>
<span class="co">#&gt; 4    WT       CTD     A     0.112     14  135.586   9.150          LAB</span>
<span class="co">#&gt; 5    WT       CTD     A     0.113     14  125.145   9.270          LAB</span>
<span class="co">#&gt; 6    WT       CTD     A     0.113     14  135.203   9.189          LGM</span>
<span class="co">#&gt; 7    WT       CTD     A     0.113     14  128.547   9.088          LAB</span>
<span class="co">#&gt; 8    WT       CTD     B     0.113     14  127.709   9.199          LGM</span>
<span class="co">#&gt; 9    WT       CTD     B     0.113     14  127.074   9.058          LGM</span>
<span class="co">#&gt; 10   WT       CTD     B     0.114     14  126.879   9.306          LGM</span>
</pre></div>
<p>We’ll then calculate the B-Basis value using the pooling by standard deviation method. This data set happens to fail some of the diagnostic tests, but for the purpose of this example, we’ll ignore those failures using the <code>override</code> argument.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw">b_basis_pooled</span> <span class="op">&lt;-</span> <span class="kw">dat</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/basis.html">basis_pooled_cv</a></span>(<span class="kw">strength</span>, <span class="kw">condition</span>, <span class="kw">batch</span>,
                  override = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"between_group_variability"</span>,
                               <span class="st">"normalized_variance_equal"</span>))

<span class="kw">b_basis_pooled</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; basis_pooled_cv(data = ., x = strength, groups = condition, batch = batch, </span>
<span class="co">#&gt;     override = c("between_group_variability", "normalized_variance_equal"))</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Distribution:  Normal - Pooled CV    ( n = 86, r = 4 )</span>
<span class="co">#&gt; The following diagnostic tests were overridden: </span>
<span class="co">#&gt;     `between_group_variability`,</span>
<span class="co">#&gt;     `normalized_variance_equal`</span>
<span class="co">#&gt; B-Basis:   ( p = 0.9 , conf = 0.95 )</span>
<span class="co">#&gt; CTD   125.1325 </span>
<span class="co">#&gt; RTD   129.3447 </span>
<span class="co">#&gt; ETW   123.809 </span>
<span class="co">#&gt; ETW2  120.3191</span>
</pre></div>
<p>The object returned from <code>basis_pooled_cv</code> contains a number of values. One value is a <code>data.frame</code> containing the groups (i.e. conditions) and the corresponding basis values. This looks like the following. We’ll use this in the visualizations.</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="kw">b_basis_pooled</span><span class="op">$</span><span class="kw">basis</span>
<span class="co">#&gt;      group    value</span>
<span class="co">#&gt; CTD    CTD 125.1325</span>
<span class="co">#&gt; RTD    RTD 129.3447</span>
<span class="co">#&gt; ETW    ETW 123.8090</span>
<span class="co">#&gt; ETW2  ETW2 120.3191</span>
</pre></div>
<div id="batch-plots" class="section level1">
<h1 class="hasAnchor">
<a href="#batch-plots" class="anchor"></a>Batch Plots</h1>
<p>Batch plots are used to identify differences between batches. Simple batch plots can be created using box plots and adding horizontal lines for the basis values as follows. Note that the heavy line in the box of the box plot is the <em>median</em>, not the mean. The two hinges correspond with the first and third quantiles and the whiskers extend to the most extreme data point, or 1.5 times the inner quantile range.</p>
<p>In the code below, we use the function <code>rename</code> to rename the column <code>group</code> to <code>condition</code>. The <code>data.frame</code> produced by <code>basis_pooled_cv</code> uses the columns <code>value</code> and <code>group</code>, but to match the data, we need the column with the conditions to be named <code>condition</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw">dat</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(x = <span class="kw">batch</span>, y = <span class="kw">strength</span>)) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span>() <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span>(width = <span class="fl">0.25</span>) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(yintercept = <span class="kw">value</span>),
             data = <span class="kw">b_basis_pooled</span><span class="op">$</span><span class="kw">basis</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(condition = <span class="kw">group</span>),
             color = <span class="st">"blue"</span>) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span>(<span class="kw">.</span> <span class="op">~</span> <span class="kw">condition</span>) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Batch Plot"</span>)
</pre></div>
<p><img src="cmstatr_Graphing_files/figure-html/unnamed-chunk-5-1.png" width="576"></p>
</div>
<div id="quantile-plots" class="section level1">
<h1 class="hasAnchor">
<a href="#quantile-plots" class="anchor"></a>Quantile Plots</h1>
<p>A quantile plot provides a graphical summary of sample values. This plot displays the sample values and the corresponding quantile. A quantile plot can be used to examine the symmetry and tail sizes of the underlying distribution. Sharp rises may indicate the presence of outliers.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="kw">dat</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(x = <span class="kw">strength</span>, color = <span class="kw">condition</span>)) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ecdf.html">stat_ecdf</a></span>(geom = <span class="st">"point"</span>) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span>() <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Quantile Plot"</span>)
</pre></div>
<p><img src="cmstatr_Graphing_files/figure-html/unnamed-chunk-6-1.png" width="576"></p>
</div>
<div id="normal-survival-function-plots" class="section level1">
<h1 class="hasAnchor">
<a href="#normal-survival-function-plots" class="anchor"></a>Normal Survival Function Plots</h1>
<p>An empirical survival function, and the corresponding normal survival function can be plotted using two <code>ggplot</code> “stat” functions provided by <code>cmstatr</code>. In the example below, the empirical survival function is plotted for each condition, and the survival function for a normal distribution with the mean and variance from the data is also plotted (the survival function is 1 minus the cumulative distribution function). This type of plot can be used to identify how closely the data follows a normal distribution, and also to compare the distributions of the various conditions.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="kw">dat</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(x = <span class="kw">strength</span>, color = <span class="kw">condition</span>)) <span class="op">+</span>
  <span class="fu"><a href="../reference/stat_normal_surv_func.html">stat_normal_surv_func</a></span>() <span class="op">+</span>
  <span class="fu"><a href="../reference/stat_esf.html">stat_esf</a></span>() <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Normal Survival Function Plot"</span>)
</pre></div>
<p><img src="cmstatr_Graphing_files/figure-html/unnamed-chunk-7-1.png" width="576"></p>
</div>
<div id="normal-score-plots" class="section level1">
<h1 class="hasAnchor">
<a href="#normal-score-plots" class="anchor"></a>Normal Score Plots</h1>
<p>The normal scores plot calculates the normal score and plots it against the normal score. Normal plots are useful to investigate distributions of the data.</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="kw">dat</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="kw">condition</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(norm.score = <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span>(<span class="kw">strength</span>)) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(x = <span class="kw">norm.score</span>, y = <span class="kw">strength</span>, colour = <span class="kw">condition</span>)) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>() <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Normal Scores Plot"</span>) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()
</pre></div>
<p><img src="cmstatr_Graphing_files/figure-html/unnamed-chunk-8-1.png" width="576"></p>
</div>
<div id="q-q-plots" class="section level1">
<h1 class="hasAnchor">
<a href="#q-q-plots" class="anchor"></a>Q-Q Plots</h1>
<p>A Q-Q plot compares the data against the theoretical quantiles for a particular distribution. A line is also plotted showing the normal distribution with mean and variance from the data. If the data exactly followed a normal distribution, all points would fall on this line.</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="kw">dat</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(sample = <span class="kw">strength</span>, colour = <span class="kw">condition</span>)) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_qq.html">geom_qq</a></span>() <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_qq.html">geom_qq_line</a></span>() <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Q-Q Plot"</span>) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()
</pre></div>
<p><img src="cmstatr_Graphing_files/figure-html/unnamed-chunk-9-1.png" width="576"></p>
</div>
<div id="property-plots" class="section level1">
<h1 class="hasAnchor">
<a href="#property-plots" class="anchor"></a>Property Plots</h1>
<p>Property plots allow for a variety of properties for a group to be compared to other properties within the same group, as well as to other group properties. The properties included in this plot are A-Basis, B-Basis, Pooled A- and B-Basis, Pooled Modified CV (Coefficient of Variation) A- and B-Basis, Mean, and Min for each group.</p>
<p>The property plots will take a bit of work to construct.</p>
<p>First, the distribution of each group must be determined. Once the distribution has been determined, the proper basis calculation based on that distribution should be filled in below. We also have a column in the tables below for extra arguments to pass to the <code>basis</code> function, such as overrides required or the method for the <code>basis_hk_ext</code> function to use.</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="kw">b_basis_fcn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
  <span class="op">~</span><span class="kw">condition</span>, <span class="op">~</span><span class="kw">fcn</span>, <span class="op">~</span><span class="kw">args</span>,
  <span class="st">"CTD"</span>, <span class="st">"basis_normal"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(override = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"between_batch_variability"</span>)),
  <span class="st">"RTD"</span>, <span class="st">"basis_normal"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(override = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"between_batch_variability"</span>)),
  <span class="st">"ETW"</span>, <span class="st">"basis_hk_ext"</span>, <span class="kw">NULL</span>,
  <span class="st">"ETW2"</span>, <span class="st">"basis_normal"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(override = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"between_batch_variability"</span>))
)

<span class="kw">a_basis_fcn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
  <span class="op">~</span><span class="kw">condition</span>, <span class="op">~</span><span class="kw">fcn</span>, <span class="op">~</span><span class="kw">args</span>,
  <span class="st">"CTD"</span>, <span class="st">"basis_normal"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(override = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"between_batch_variability"</span>)),
  <span class="st">"RTD"</span>, <span class="st">"basis_normal"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(override = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"between_batch_variability"</span>)),
  <span class="st">"ETW"</span>, <span class="st">"basis_hk_ext"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(method = <span class="st">"woodward-frawley"</span>),
  <span class="st">"ETW2"</span>, <span class="st">"basis_normal"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(override = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"between_batch_variability"</span>))
)
</pre></div>
<p>We’ll write a function that takes the data and information about the distribution and computes the single-point basis value. We’ll use this function for both A- and B-Basis, so we’ll add a parameter for the probability (0.90 or 0.99).</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="kw">single_point_fcn</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">group_x</span>, <span class="kw">group_batch</span>, <span class="kw">cond</span>, <span class="kw">basis_fcn</span>, <span class="kw">p</span>) {
  <span class="kw">fcn</span> <span class="op">&lt;-</span> <span class="kw">basis_fcn</span><span class="op">$</span><span class="kw">fcn</span>[<span class="kw">basis_fcn</span><span class="op">$</span><span class="kw">condition</span> <span class="op">==</span> <span class="kw">cond</span>[<span class="fl">1</span>]]
  <span class="kw">extra_args</span> <span class="op">&lt;-</span> <span class="kw">basis_fcn</span><span class="op">$</span><span class="kw">args</span>[<span class="kw">basis_fcn</span><span class="op">$</span><span class="kw">condition</span> <span class="op">==</span> <span class="kw">cond</span>[<span class="fl">1</span>]]

  <span class="kw">args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(x = <span class="kw">group_x</span>, batch = <span class="kw">group_batch</span>, p = <span class="kw">p</span>),
    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="kw">extra_args</span>))
  <span class="kw">basis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(<span class="kw">fcn</span>, <span class="kw">args</span>)
  <span class="kw">basis</span><span class="op">$</span><span class="kw">basis</span>
}

<span class="kw">single_point_results</span> <span class="op">&lt;-</span> <span class="kw">dat</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="kw">condition</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(single_point_b_basis = <span class="fu">single_point_fcn</span>(
              <span class="kw">strength</span>, <span class="kw">batch</span>, <span class="kw">condition</span>, <span class="kw">b_basis_fcn</span>, <span class="fl">0.90</span>),
            single_point_a_basis = <span class="fu">single_point_fcn</span>(
              <span class="kw">strength</span>, <span class="kw">batch</span>, <span class="kw">condition</span>, <span class="kw">a_basis_fcn</span>, <span class="fl">0.99</span>),
            minimum = <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="kw">strength</span>),
            mean = <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="kw">strength</span>)) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(condition = <span class="fu"><a href="https://rdrr.io/r/base/factor.html">ordered</a></span>(<span class="kw">condition</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"CTD"</span>, <span class="st">"RTD"</span>, <span class="st">"ETW"</span>, <span class="st">"ETW2"</span>)))
<span class="co">#&gt; `summarise()` ungrouping output (override with `.groups` argument)</span>

<span class="kw">single_point_results</span>
<span class="co">#&gt; # A tibble: 4 x 5</span>
<span class="co">#&gt;   condition single_point_b_basis single_point_a_basis minimum  mean</span>
<span class="co">#&gt;   &lt;ord&gt;                    &lt;dbl&gt;                &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 CTD                       121.                 111.    125.  135.</span>
<span class="co">#&gt; 2 RTD                       128.                 119.    127.  140.</span>
<span class="co">#&gt; 3 ETW                       121.                 103.    125.  134.</span>
<span class="co">#&gt; 4 ETW2                      123.                 119.    123.  130.</span>
</pre></div>
<p>In the above code, we also ensure that the condition column is still in the order we expect.</p>
<p>We’ve already computed the B-Basis of the data using a pooling method. We’ll do the same for A-Basis:</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="kw">a_basis_pooled</span> <span class="op">&lt;-</span> <span class="kw">dat</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/basis.html">basis_pooled_cv</a></span>(<span class="kw">strength</span>, <span class="kw">condition</span>, <span class="kw">batch</span>, p = <span class="fl">0.99</span>,
                  override = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"between_group_variability"</span>,
                               <span class="st">"normalized_variance_equal"</span>))

<span class="kw">a_basis_pooled</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; basis_pooled_cv(data = ., x = strength, groups = condition, batch = batch, </span>
<span class="co">#&gt;     p = 0.99, override = c("between_group_variability", "normalized_variance_equal"))</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Distribution:  Normal - Pooled CV    ( n = 86, r = 4 )</span>
<span class="co">#&gt; The following diagnostic tests were overridden: </span>
<span class="co">#&gt;     `between_group_variability`,</span>
<span class="co">#&gt;     `normalized_variance_equal`</span>
<span class="co">#&gt; A-Basis:   ( p = 0.99 , conf = 0.95 )</span>
<span class="co">#&gt; CTD   118.3205 </span>
<span class="co">#&gt; RTD   122.2636 </span>
<span class="co">#&gt; ETW   117.074 </span>
<span class="co">#&gt; ETW2  113.7601</span>
</pre></div>
<p>As we saw before, the returned object has a property called <code>basis</code>, which is a <code>data.frame</code> for the pooling methods.</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="kw">a_basis_pooled</span><span class="op">$</span><span class="kw">basis</span>
<span class="co">#&gt;      group    value</span>
<span class="co">#&gt; CTD    CTD 118.3205</span>
<span class="co">#&gt; RTD    RTD 122.2636</span>
<span class="co">#&gt; ETW    ETW 117.0740</span>
<span class="co">#&gt; ETW2  ETW2 113.7601</span>
</pre></div>
<p>We can take this <code>data.frame</code> and change the column names to suit our needs.</p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="kw">a_basis_pooled</span><span class="op">$</span><span class="kw">basis</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(condition = <span class="kw">group</span>,
         b_basis_pooled = <span class="kw">value</span>)
<span class="co">#&gt;      condition b_basis_pooled</span>
<span class="co">#&gt; CTD        CTD       118.3205</span>
<span class="co">#&gt; RTD        RTD       122.2636</span>
<span class="co">#&gt; ETW        ETW       117.0740</span>
<span class="co">#&gt; ETW2      ETW2       113.7601</span>
</pre></div>
<p>We can combine all these steps into one statement. We’ll also ensure that the conditions are listed in the order we want.</p>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="kw">a_basis_pooled_results</span> <span class="op">&lt;-</span> <span class="kw">a_basis_pooled</span><span class="op">$</span><span class="kw">basis</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(condition = <span class="kw">group</span>,
         a_basis_pooled = <span class="kw">value</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(condition = <span class="fu"><a href="https://rdrr.io/r/base/factor.html">ordered</a></span>(<span class="kw">condition</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"CTD"</span>, <span class="st">"RTD"</span>, <span class="st">"ETW"</span>, <span class="st">"ETW2"</span>)))

<span class="kw">a_basis_pooled_results</span>
<span class="co">#&gt;   condition a_basis_pooled</span>
<span class="co">#&gt; 1       CTD       118.3205</span>
<span class="co">#&gt; 2       RTD       122.2636</span>
<span class="co">#&gt; 3       ETW       117.0740</span>
<span class="co">#&gt; 4      ETW2       113.7601</span>
</pre></div>
<p>And the same thing for B-Basis:</p>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="kw">b_basis_pooled_results</span> <span class="op">&lt;-</span> <span class="kw">b_basis_pooled</span><span class="op">$</span><span class="kw">basis</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(condition = <span class="kw">group</span>,
         b_basis_pooled = <span class="kw">value</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(condition = <span class="fu"><a href="https://rdrr.io/r/base/factor.html">ordered</a></span>(<span class="kw">condition</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"CTD"</span>, <span class="st">"RTD"</span>, <span class="st">"ETW"</span>, <span class="st">"ETW2"</span>)))

<span class="kw">b_basis_pooled_results</span>
<span class="co">#&gt;   condition b_basis_pooled</span>
<span class="co">#&gt; 1       CTD       125.1325</span>
<span class="co">#&gt; 2       RTD       129.3447</span>
<span class="co">#&gt; 3       ETW       123.8090</span>
<span class="co">#&gt; 4      ETW2       120.3191</span>
</pre></div>
<p>We can use the function <code>inner_join</code> from the <code>dplyr</code> package to combine the three sets of computational results. Each row for each condition will be concatenated.</p>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="kw">single_point_results</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span>(<span class="kw">b_basis_pooled_results</span>, by = <span class="st">"condition"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span>(<span class="kw">a_basis_pooled_results</span>, by = <span class="st">"condition"</span>)
<span class="co">#&gt; # A tibble: 4 x 7</span>
<span class="co">#&gt;   condition single_point_b_… single_point_a_… minimum  mean b_basis_pooled</span>
<span class="co">#&gt;   &lt;ord&gt;                &lt;dbl&gt;            &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;          &lt;dbl&gt;</span>
<span class="co">#&gt; 1 CTD                   121.             111.    125.  135.           125.</span>
<span class="co">#&gt; 2 RTD                   128.             119.    127.  140.           129.</span>
<span class="co">#&gt; 3 ETW                   121.             103.    125.  134.           124.</span>
<span class="co">#&gt; 4 ETW2                  123.             119.    123.  130.           120.</span>
<span class="co">#&gt; # … with 1 more variable: a_basis_pooled &lt;dbl&gt;</span>
</pre></div>
<p>To use this table in the plot we’re trying to construct, we want to “lengthen” the table as follows.</p>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="kw">single_point_results</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span>(<span class="kw">b_basis_pooled_results</span>, by = <span class="st">"condition"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span>(<span class="kw">a_basis_pooled_results</span>, by = <span class="st">"condition"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span>(cols = <span class="kw">single_point_b_basis</span><span class="op">:</span><span class="kw">a_basis_pooled</span>)
<span class="co">#&gt; # A tibble: 24 x 3</span>
<span class="co">#&gt;    condition name                 value</span>
<span class="co">#&gt;    &lt;ord&gt;     &lt;chr&gt;                &lt;dbl&gt;</span>
<span class="co">#&gt;  1 CTD       single_point_b_basis  121.</span>
<span class="co">#&gt;  2 CTD       single_point_a_basis  111.</span>
<span class="co">#&gt;  3 CTD       minimum               125.</span>
<span class="co">#&gt;  4 CTD       mean                  135.</span>
<span class="co">#&gt;  5 CTD       b_basis_pooled        125.</span>
<span class="co">#&gt;  6 CTD       a_basis_pooled        118.</span>
<span class="co">#&gt;  7 RTD       single_point_b_basis  128.</span>
<span class="co">#&gt;  8 RTD       single_point_a_basis  119.</span>
<span class="co">#&gt;  9 RTD       minimum               127.</span>
<span class="co">#&gt; 10 RTD       mean                  140.</span>
<span class="co">#&gt; # … with 14 more rows</span>
</pre></div>
<p>We can now make a plot based on this:</p>
<div class="sourceCode" id="cb19"><pre class="downlit">
<span class="kw">single_point_results</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span>(<span class="kw">b_basis_pooled_results</span>, by = <span class="st">"condition"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span>(<span class="kw">a_basis_pooled_results</span>, by = <span class="st">"condition"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span>(cols = <span class="kw">single_point_b_basis</span><span class="op">:</span><span class="kw">a_basis_pooled</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(x = <span class="kw">condition</span>, y = <span class="kw">value</span>)) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(y = <span class="kw">strength</span>), data = <span class="kw">dat</span>) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(shape = <span class="kw">name</span>, color = <span class="kw">name</span>)) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Property Graph"</span>) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()
</pre></div>
<p><img src="cmstatr_Graphing_files/figure-html/unnamed-chunk-19-1.png" width="576"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.kloppenborg.ca">Stefan Kloppenborg</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
