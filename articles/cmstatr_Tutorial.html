<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>cmstatr Tutorial • cmstatr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="cmstatr Tutorial">
<meta property="og:description" content="cmstatr">
<meta property="og:image" content="https://www.cmstatr.net/reference/figures/logo-240x278.png">
<meta property="og:image:alt" content="Statistical methods for composite material data: cmstatr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cmstatr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.9.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/adktest.html">Anderson-Darling k-Sample Test</a>
    </li>
    <li>
      <a href="../articles/cmstatr_Graphing.html">Plotting Composite Material Data</a>
    </li>
    <li>
      <a href="../articles/cmstatr_Tutorial.html">cmstatr Tutorial</a>
    </li>
    <li>
      <a href="../articles/cmstatr_Validation.html">cmstatr Validation</a>
    </li>
    <li>
      <a href="../articles/hk_ext.html">Extended Hanson-Koopmans</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/cmstatr/cmstatr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>cmstatr Tutorial</h1>
                        <h4 data-toc-skip class="author">Stefan
Kloppenborg</h4>
            
            <h4 data-toc-skip class="date">1-Apr-2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/cmstatr/cmstatr/blob/HEAD/vignettes/cmstatr_Tutorial.Rmd" class="external-link"><code>vignettes/cmstatr_Tutorial.Rmd</code></a></small>
      <div class="hidden name"><code>cmstatr_Tutorial.Rmd</code></div>

    </div>

    
    
<p><code>cmstatr</code> is an R package for analyzing composite material
data for use in the aerospace industry. The statistical methods are
based on those published in <a href="https://www.cmh17.org/" class="external-link">CMH-17-1G</a>. This package is intended to
facilitate reproducible statistical analysis of composite materials. In
this tutorial, we’ll explore the basic functionality of
<code>cmstatr</code>.</p>
<p>Before we can actually use the package, we’ll need to load it. We’ll
also load the <code>dplyr</code> package, which we’ll talk about
shortly. There are also a few other packages that we’ll load. These
could all be loaded by loading the <code>tidyverse</code> package
instead.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.cmstatr.net/">cmstatr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="input-data">Input Data<a class="anchor" aria-label="anchor" href="#input-data"></a>
</h2>
<p><code>cmstatr</code> is built with the assumption that the data is in
(so called) <a href="http://vita.had.co.nz/papers/tidy-data.html" class="external-link">tidy
data</a> format. This means that the data is in a data frame and that
each observation (i.e. test result) has its own row and that each
variable has its own column. Included in this package is a sample
composite material data set (this data set is fictional: don’t use it
for anything other than learning this package). The data set
<code>carbon.fabric.2</code> has the expected format. We’ll just show
the first 10 rows of the data for now.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">carbon.fabric.2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;    test condition batch panel thickness nplies strength modulus failure_mode</span></span>
<span><span class="co">#&gt; 1    WT       CTD     A     1     0.112     14  142.817   9.285          LAT</span></span>
<span><span class="co">#&gt; 2    WT       CTD     A     1     0.113     14  135.901   9.133          LAT</span></span>
<span><span class="co">#&gt; 3    WT       CTD     A     1     0.113     14  132.511   9.253          LAT</span></span>
<span><span class="co">#&gt; 4    WT       CTD     A     2     0.112     14  135.586   9.150          LAB</span></span>
<span><span class="co">#&gt; 5    WT       CTD     A     2     0.113     14  125.145   9.270          LAB</span></span>
<span><span class="co">#&gt; 6    WT       CTD     A     2     0.113     14  135.203   9.189          LGM</span></span>
<span><span class="co">#&gt; 7    WT       CTD     A     2     0.113     14  128.547   9.088          LAB</span></span>
<span><span class="co">#&gt; 8    WT       CTD     B     1     0.113     14  127.709   9.199          LGM</span></span>
<span><span class="co">#&gt; 9    WT       CTD     B     1     0.113     14  127.074   9.058          LGM</span></span>
<span><span class="co">#&gt; 10   WT       CTD     B     1     0.114     14  126.879   9.306          LGM</span></span></code></pre></div>
<p>If your data set is not yet in this type of format (note: that the
column names <em>do not</em> need to match the column names in the
example), there are many ways to get it into this format. One of the
easier ways of doing so is to use the <a href="https://tidyr.tidyverse.org/" class="external-link"><code>tidyr</code></a> package. The
use of this package is outside the scope of this vignette.</p>
</div>
<div class="section level2">
<h2 id="working-with-data">Working With Data<a class="anchor" aria-label="anchor" href="#working-with-data"></a>
</h2>
<p>Throughout this vignette, we will be using some of the
<code>tidyverse</code> tools for working with data. There are several
ways to work with data in R, but in the opinion of the author of this
vignette, the <code>tidyverse</code> provides the easiest way to do so.
As such, this is the approach used in this vignette. Feel free to use
whichever approach works best for you.</p>
</div>
<div class="section level2">
<h2 id="normalizing-data-to-cured-ply-thickness">Normalizing Data to Cured Ply Thickness<a class="anchor" aria-label="anchor" href="#normalizing-data-to-cured-ply-thickness"></a>
</h2>
<p>Very often, you’ll want to normalize as-measured strength data to a
nominal cured ply thickness for fiber-dominated properties. Very often,
this will reduce the apparent variance in the data. The
<code>normalize_ply_thickness</code> function can be used to normalize
strength or modulus data to a certain cured ply thickness. This function
takes three arguments: the value to normalize (i.e.. strength or
modulus), the measured thickness and the nominal thickness. In our case,
the nominal cured ply thickness of the material is <span class="math inline">\(0.0079\)</span>. We can then normalize the
warp-tension and fill-compression data as follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">norm_data</span> <span class="op">&lt;-</span> <span class="va">carbon.fabric.2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">test</span> <span class="op">==</span> <span class="st">"WT"</span> <span class="op">|</span> <span class="va">test</span> <span class="op">==</span> <span class="st">"FC"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>strength.norm <span class="op">=</span> <span class="fu"><a href="../reference/normalize_ply_thickness.html">normalize_ply_thickness</a></span><span class="op">(</span><span class="va">strength</span>,</span>
<span>                                                 <span class="va">thickness</span> <span class="op">/</span> <span class="va">nplies</span>,</span>
<span>                                                 <span class="fl">0.0079</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">norm_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;    test condition batch panel thickness nplies strength modulus failure_mode</span></span>
<span><span class="co">#&gt; 1    WT       CTD     A     1     0.112     14  142.817   9.285          LAT</span></span>
<span><span class="co">#&gt; 2    WT       CTD     A     1     0.113     14  135.901   9.133          LAT</span></span>
<span><span class="co">#&gt; 3    WT       CTD     A     1     0.113     14  132.511   9.253          LAT</span></span>
<span><span class="co">#&gt; 4    WT       CTD     A     2     0.112     14  135.586   9.150          LAB</span></span>
<span><span class="co">#&gt; 5    WT       CTD     A     2     0.113     14  125.145   9.270          LAB</span></span>
<span><span class="co">#&gt; 6    WT       CTD     A     2     0.113     14  135.203   9.189          LGM</span></span>
<span><span class="co">#&gt; 7    WT       CTD     A     2     0.113     14  128.547   9.088          LAB</span></span>
<span><span class="co">#&gt; 8    WT       CTD     B     1     0.113     14  127.709   9.199          LGM</span></span>
<span><span class="co">#&gt; 9    WT       CTD     B     1     0.113     14  127.074   9.058          LGM</span></span>
<span><span class="co">#&gt; 10   WT       CTD     B     1     0.114     14  126.879   9.306          LGM</span></span>
<span><span class="co">#&gt;    strength.norm</span></span>
<span><span class="co">#&gt; 1       144.6248</span></span>
<span><span class="co">#&gt; 2       138.8500</span></span>
<span><span class="co">#&gt; 3       135.3865</span></span>
<span><span class="co">#&gt; 4       137.3023</span></span>
<span><span class="co">#&gt; 5       127.8606</span></span>
<span><span class="co">#&gt; 6       138.1369</span></span>
<span><span class="co">#&gt; 7       131.3364</span></span>
<span><span class="co">#&gt; 8       130.4803</span></span>
<span><span class="co">#&gt; 9       129.8315</span></span>
<span><span class="co">#&gt; 10      130.7794</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="calculating-single-point-basis-value">Calculating Single-Point Basis Value<a class="anchor" aria-label="anchor" href="#calculating-single-point-basis-value"></a>
</h2>
<p>The simplest thing that you will likely do is to calculate a basis
value based of a set of numbers that you consider as unstructured data.
An example of this would be calculating the B-Basis of the
<code>RTD</code> warp tension (<code>WT</code>) data.</p>
<p>There are a number of diagnostic tests that we should run before
actually calculating a B-Basis value. We’ll talk about those later, but
for now, let’s just get right to checking how the data are distributed
and calculating the B-Basis.</p>
<p>We’ll use an Anderson–Darling test to check if the data are normally
distributed. The <code>cmstatr</code> package provides the function
<code>anderson_darling_normal</code> and related functions for other
distributions. We can run an Anderson–Darling test for normality on the
warp tension RTD data as follows. We’ll perform this test on the
normalized strength.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">norm_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">test</span> <span class="op">==</span> <span class="st">"WT"</span> <span class="op">&amp;</span> <span class="va">condition</span> <span class="op">==</span> <span class="st">"RTD"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/anderson_darling.html">anderson_darling_normal</a></span><span class="op">(</span><span class="va">strength.norm</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; anderson_darling_normal(data = ., x = strength.norm)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Distribution:  Normal ( n = 28 ) </span></span>
<span><span class="co">#&gt; Test statistic:  A = 0.3805995 </span></span>
<span><span class="co">#&gt; OSL (p-value):  0.3132051  (assuming unknown parameters)</span></span>
<span><span class="co">#&gt; Conclusion: Sample is drawn from a Normal distribution ( alpha = 0.05 )</span></span></code></pre></div>
<p>Now that we know that this data follows a normal distribution (since
the observed significance level (OSL) of the Anderson–Darling test is
greater than <span class="math inline">\(0.05\)</span>), we can proceed
to calculate a basis value based based on the assumption of normally
distributed data. The <code>cmstatr</code> package provides the function
<code>basis_normal</code> as well as related functions for other
distributions. By default, the B-Basis value is calculated, but other
population proportions and confidence bounds can be specified (for
example, specify <code>p = 0.99, conf = 0.99</code> for A-Basis).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">norm_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">test</span> <span class="op">==</span> <span class="st">"WT"</span> <span class="op">&amp;</span> <span class="va">condition</span> <span class="op">==</span> <span class="st">"RTD"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/basis.html">basis_normal</a></span><span class="op">(</span><span class="va">strength.norm</span><span class="op">)</span></span>
<span><span class="co">#&gt; `outliers_within_batch` not run because parameter `batch` not specified</span></span>
<span><span class="co">#&gt; `between_batch_variability` not run because parameter `batch` not specified</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; basis_normal(data = ., x = strength.norm)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Distribution:  Normal    ( n = 28 )</span></span>
<span><span class="co">#&gt; B-Basis:   ( p = 0.9 , conf = 0.95 )</span></span>
<span><span class="co">#&gt; 129.9583</span></span></code></pre></div>
<p>We see that the calculated B-Basis is <span class="math inline">\(129.96\)</span>. We also see two messages issued
by the <code>cmstatr</code> package. These messages relate to the
automated diagnostic tests performed by the basis calculation functions.
In this case we see messages that two of the diagnostic tests were not
performed because we didn’t specify the batch of each observation. The
batch is not required for calculating single-point basis values, but it
is required for performing batch-to-batch variability and within-batch
outlier diagnostic tests.</p>
<p>The <code>basis_normal</code> function performs the following
diagnostic tests by default:</p>
<ul>
<li>Within batch outliers using
<code><a href="../reference/maximum_normed_residual.html">maximum_normed_residual()</a></code>
</li>
<li>Between batch variability using <code><a href="../reference/ad_ksample.html">ad_ksample()</a></code>
</li>
<li>Outliers using <code><a href="../reference/maximum_normed_residual.html">maximum_normed_residual()</a></code>
</li>
<li>Normality of data using <code><a href="../reference/anderson_darling.html">anderson_darling_normal()</a></code>
</li>
</ul>
<p>There are two ways that we can deal with the two messages that we
see. We can pass in a column that specifies the batch for each
observation, or we can override those two diagnostic tests so that
<code>cmstatr</code> doesn’t run them.</p>
<p>To override the two diagnostic tests, we set the argument
<code>override</code> to a list of the names of the diagnostic tests
that we want to skip. The names of the diagnostic tests that were not
run are shown between back-ticks (`) in the message. Our call to
<code><a href="../reference/basis.html">basis_normal()</a></code> would be updated as follows:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">norm_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">test</span> <span class="op">==</span> <span class="st">"WT"</span> <span class="op">&amp;</span> <span class="va">condition</span> <span class="op">==</span> <span class="st">"RTD"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/basis.html">basis_normal</a></span><span class="op">(</span><span class="va">strength.norm</span>, </span>
<span>               override <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"outliers_within_batch"</span>,</span>
<span>                            <span class="st">"between_batch_variability"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; basis_normal(data = ., x = strength.norm, override = c("outliers_within_batch", </span></span>
<span><span class="co">#&gt;     "between_batch_variability"))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Distribution:  Normal    ( n = 28 )</span></span>
<span><span class="co">#&gt; The following diagnostic tests were overridden:</span></span>
<span><span class="co">#&gt;     `outliers_within_batch`,</span></span>
<span><span class="co">#&gt;     `between_batch_variability`</span></span>
<span><span class="co">#&gt; B-Basis:   ( p = 0.9 , conf = 0.95 )</span></span>
<span><span class="co">#&gt; 129.9583</span></span></code></pre></div>
<p>Obviously, you should be cautious about overriding the diagnostic
tests. There are certainly times when it is appropriate to do so, but
sound engineering judgment is required.</p>
<p>The better approach would be to specify the batch. This can be done
as follows:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">norm_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">test</span> <span class="op">==</span> <span class="st">"WT"</span> <span class="op">&amp;</span> <span class="va">condition</span> <span class="op">==</span> <span class="st">"RTD"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/basis.html">basis_normal</a></span><span class="op">(</span><span class="va">strength.norm</span>, <span class="va">batch</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: `between_batch_variability` failed: Anderson-Darling k-Sample test</span></span>
<span><span class="co">#&gt; indicates that batches are drawn from different distributions</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; basis_normal(data = ., x = strength.norm, batch = batch)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Distribution:  Normal    ( n = 28 )</span></span>
<span><span class="co">#&gt; The following diagnostic tests failed:</span></span>
<span><span class="co">#&gt;     `between_batch_variability`</span></span>
<span><span class="co">#&gt; B-Basis:   ( p = 0.9 , conf = 0.95 )</span></span>
<span><span class="co">#&gt; 129.9583</span></span></code></pre></div>
<p>Now that batch is specified, we see that one of the diagnostic tests
actually fails: the Anderson–Darling k-Sample test shows that the
batches are not drawn from the same (unspecified) distribution. We can
run this diagnostic test directly to investigate further:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">norm_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">test</span> <span class="op">==</span> <span class="st">"WT"</span> <span class="op">&amp;</span> <span class="va">condition</span> <span class="op">==</span> <span class="st">"RTD"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/ad_ksample.html">ad_ksample</a></span><span class="op">(</span><span class="va">strength.norm</span>, <span class="va">batch</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ad_ksample(data = ., x = strength.norm, groups = batch)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; N = 28           k = 3            </span></span>
<span><span class="co">#&gt; ADK = 6.65       p-value = 0.0025892 </span></span>
<span><span class="co">#&gt; Conclusion: Samples do not come from the same distribution (alpha = 0.025 )</span></span></code></pre></div>
<p>For the Anderson–Darling k-Sample test, <span class="math inline">\(\alpha=0.025\)</span> is normally used. In this
case the p-value is <span class="math inline">\(p=0.0026\)</span>, so it
is no where near <span class="math inline">\(\alpha\)</span> (note the
number of decimal places).</p>
<p>We can plot the distribution of this data and make a judgment call
about whether to continue.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">norm_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">test</span> <span class="op">==</span> <span class="st">"WT"</span> <span class="op">&amp;</span> <span class="va">condition</span> <span class="op">==</span> <span class="st">"RTD"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">batch</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">strength.norm</span>, color <span class="op">=</span> <span class="va">batch</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/stat_normal_surv_func.html">stat_normal_surv_func</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/stat_esf.html">stat_esf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Distribution of Data For Each Batch"</span><span class="op">)</span></span></code></pre></div>
<p><img src="cmstatr_Tutorial_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>We can also run the other diagnostic test by themselves. These are
described in more detail in the following sections.</p>
</div>
<div class="section level2">
<h2 id="calculating-basis-values-by-pooling-across-environments">Calculating Basis Values by Pooling Across Environments<a class="anchor" aria-label="anchor" href="#calculating-basis-values-by-pooling-across-environments"></a>
</h2>
<p>In this section, we’ll use the fill-compression data from the
<code>carbon.fabric.2</code> data set.</p>
<div class="section level3">
<h3 id="checking-for-outliers">Checking for Outliers<a class="anchor" aria-label="anchor" href="#checking-for-outliers"></a>
</h3>
<p>After checking that there are a sufficient number of conditions,
batches and specimens and that the failure modes are consistent, we
would normally check if there are outliers within each batch and
condition. The maximum normed residual test can be used for this. The
<code>cmstatr</code> package provides the function
<code>maximum_normed_residual</code> to do this. First, we’ll group the
data by condition and batch, then run the test on each group. The
<code>maximum_normed_residual</code> function returns an object that
contains a number of values. We’ll create a <code>data.frame</code> that
contains those values.</p>
<p>In order to do this, we need to use the <code>nest</code> function
from the <code>tidyr</code> package. This is explained in detail <a href="https://tidyr.tidyverse.org/articles/nest.html" class="external-link">here</a>.
Basically, <code>nest</code> allows a column of <code>list</code>s or a
column of <code>data.frame</code>s to be added to a
<code>data.frame</code>. Once nested, we can use the <code>glance</code>
method to unpack the values returned by
<code>maximum_normed_residual</code> into a one-row
<code>data.frame</code>, and then use <code>unnest</code> to flatten
this into a single <code>data.frame</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">norm_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">test</span> <span class="op">==</span> <span class="st">"FC"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">condition</span>, <span class="va">batch</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>mnr <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>                   <span class="op">~</span><span class="fu"><a href="../reference/maximum_normed_residual.html">maximum_normed_residual</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">.x</span>, x <span class="op">=</span> <span class="va">strength.norm</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         tidied <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">mnr</span>, <span class="va">glance</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mnr</span>, <span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="co"># remove unneeded columns</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">tidied</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 15 × 6</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   condition, batch [15]</span></span></span>
<span><span class="co">#&gt;    condition batch   mnr alpha  crit n_outliers</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> CTD       A      1.48  0.05  1.89          0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> CTD       B      1.72  0.05  1.89          0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> CTD       C      1.52  0.05  1.89          0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> RTD       A      1.34  0.05  1.89          0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> RTD       B      1.47  0.05  1.89          0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> RTD       C      1.52  0.05  1.89          0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ETD       A      1.66  0.05  1.89          0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ETD       B      1.53  0.05  1.89          0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ETD       C      1.40  0.05  1.89          0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ETW       A      1.45  0.05  1.89          0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> ETW       B      1.83  0.05  1.89          0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> ETW       C      1.76  0.05  1.89          0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> ETW2      A      1.85  0.05  1.89          0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> ETW2      B      1.54  0.05  1.89          0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> ETW2      C      1.38  0.05  2.02          0</span></span></code></pre></div>
<p>None of the groups have outliers, so we can continue.</p>
</div>
</div>
<div class="section level2">
<h2 id="batch-to-batch-distribution">Batch-to-Batch Distribution<a class="anchor" aria-label="anchor" href="#batch-to-batch-distribution"></a>
</h2>
<p>Next, we will use the Anderson–Darling k-Sample test to check that
each batch comes from the same distribution within each condition. We
can use the <code>ad_ksample</code> function from <code>cmstatr</code>
to do so. Once again, we’ll use <code>nest</code>/<code>unnest</code>
and <code>glance</code> to do so.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">norm_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">test</span> <span class="op">==</span> <span class="st">"FC"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">condition</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>adk <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="op">~</span><span class="fu"><a href="../reference/ad_ksample.html">ad_ksample</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">.x</span>,</span>
<span>                                     x <span class="op">=</span> <span class="va">strength.norm</span>,</span>
<span>                                     groups <span class="op">=</span> <span class="va">batch</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         tidied <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">adk</span>, <span class="va">glance</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">adk</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="co"># remove unneeded columns</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">tidied</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 8</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   condition [5]</span></span></span>
<span><span class="co">#&gt;   condition alpha     n     k sigma    ad     p reject_same_dist</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> CTD       0.025    18     3 0.944 1.76  0.505 FALSE           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> RTD       0.025    18     3 0.944 1.03  0.918 FALSE           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ETD       0.025    18     3 0.944 0.683 0.997 FALSE           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ETW       0.025    18     3 0.944 0.93  0.954 FALSE           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ETW2      0.025    19     3 0.951 1.74  0.513 FALSE</span></span></code></pre></div>
<p>For all conditions, the Anderson–Darling k-Sample test fails to
reject the hypothesis that each batch comes from the same (unspecified)
distribution. We can thus proceed to pooling the data.</p>
<div class="section level3">
<h3 id="checking-for-outliers-within-each-condition">Checking for Outliers Within Each Condition<a class="anchor" aria-label="anchor" href="#checking-for-outliers-within-each-condition"></a>
</h3>
<p>Just as we did when checking for outlier within each condition and
each batch, we can pool all the batches (within each condition) and
check for outliers within each condition.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">norm_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">test</span> <span class="op">==</span> <span class="st">"FC"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">condition</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>mnr <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="op">~</span><span class="fu"><a href="../reference/maximum_normed_residual.html">maximum_normed_residual</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">.x</span>,</span>
<span>                                                  x <span class="op">=</span> <span class="va">strength.norm</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         tidied <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">mnr</span>, <span class="va">glance</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mnr</span>, <span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="co"># remove unneeded columns</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">tidied</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 5</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   condition [5]</span></span></span>
<span><span class="co">#&gt;   condition   mnr alpha  crit n_outliers</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> CTD        2.38  0.05  2.65          0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> RTD        2.06  0.05  2.65          0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ETD        2.05  0.05  2.65          0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ETW        2.34  0.05  2.65          0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ETW2       2.07  0.05  2.68          0</span></span></code></pre></div>
<p>We find no outliers, so we can continue.</p>
</div>
<div class="section level3">
<h3 id="pooling-across-environments">Pooling Across Environments<a class="anchor" aria-label="anchor" href="#pooling-across-environments"></a>
</h3>
<p>Often it is desirable to pool data across several environments. There
are two methods for doing so: “pooled standard deviation” and “pooled
CV” (CV is an abbreviation for Coefficient of Variation)</p>
<p>First, we will check for equality of variance among the conditions.
We will do so using Levene’s test. The <code>cmstatr</code> package
provides the function <code>levene_test</code> to do so.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">norm_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">test</span> <span class="op">==</span> <span class="st">"FC"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/levene_test.html">levene_test</a></span><span class="op">(</span><span class="va">strength.norm</span>, <span class="va">condition</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; levene_test(data = ., x = strength.norm, groups = condition)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; n = 91           k = 5            </span></span>
<span><span class="co">#&gt; F = 5.260731     p-value = 0.0007727083 </span></span>
<span><span class="co">#&gt; Conclusion: Samples have unequal variance ( alpha = 0.05 )</span></span></code></pre></div>
<p>The result from Levene’s test indicates that the variance for each
condition is not equal. This indicates that the data cannot be pooled
using the “pooled standard deviation” method.</p>
<p>We can check if the data can be pooled using the “pooled CV” method.
We’ll start by normalizing the data from each group to the group’s mean.
The <code>cmstatr</code> package provides the function
<code>normalize_group_mean</code> for this purpose.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">norm_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">test</span> <span class="op">==</span> <span class="st">"FC"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    strength_norm_group <span class="op">=</span> <span class="fu"><a href="../reference/normalize_group_mean.html">normalize_group_mean</a></span><span class="op">(</span><span class="va">strength.norm</span>, <span class="va">condition</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/levene_test.html">levene_test</a></span><span class="op">(</span><span class="va">strength_norm_group</span>, <span class="va">condition</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; levene_test(data = ., x = strength_norm_group, groups = condition)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; n = 91           k = 5            </span></span>
<span><span class="co">#&gt; F = 1.839645     p-value = 0.1285863 </span></span>
<span><span class="co">#&gt; Conclusion: Samples have equal variances ( alpha = 0.05 )</span></span></code></pre></div>
<p>The Levene’s test thus shows the variances of the pooled data are
equal. We can move on to performing an Anderson–Darling test for
normality on the pooled data.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">norm_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">test</span> <span class="op">==</span> <span class="st">"FC"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    strength_norm_group <span class="op">=</span> <span class="fu"><a href="../reference/normalize_group_mean.html">normalize_group_mean</a></span><span class="op">(</span><span class="va">strength.norm</span>, <span class="va">condition</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/anderson_darling.html">anderson_darling_normal</a></span><span class="op">(</span><span class="va">strength_norm_group</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; anderson_darling_normal(data = ., x = strength_norm_group)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Distribution:  Normal ( n = 91 ) </span></span>
<span><span class="co">#&gt; Test statistic:  A = 0.3619689 </span></span>
<span><span class="co">#&gt; OSL (p-value):  0.3812268  (assuming unknown parameters)</span></span>
<span><span class="co">#&gt; Conclusion: Sample is drawn from a Normal distribution ( alpha = 0.05 )</span></span></code></pre></div>
<p>The Anderson–Darling test indicates that the pooled data is drawn
from a normal distribution, so we can continue with calculating basis
values using the “pooled CV” method.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">norm_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">test</span> <span class="op">==</span> <span class="st">"FC"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/basis.html">basis_pooled_cv</a></span><span class="op">(</span><span class="va">strength.norm</span>, <span class="va">condition</span>, <span class="va">batch</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; basis_pooled_cv(data = ., x = strength.norm, groups = condition, </span></span>
<span><span class="co">#&gt;     batch = batch)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Distribution:  Normal - Pooled CV    ( n = 91, r = 5 )</span></span>
<span><span class="co">#&gt; B-Basis:   ( p = 0.9 , conf = 0.95 )</span></span>
<span><span class="co">#&gt; CTD   85.09241 </span></span>
<span><span class="co">#&gt; ETD   66.55109 </span></span>
<span><span class="co">#&gt; ETW   51.43626 </span></span>
<span><span class="co">#&gt; ETW2  45.81318 </span></span>
<span><span class="co">#&gt; RTD   78.2274</span></span></code></pre></div>
<p>The conditions listed in the output above are in alphabetical order.
This probably isn’t what you want. Instead, you probably want the
conditions listed in a certain order. This can be done by ordering the
data first as demonstrated below. You’re probably just do this one in at
the start of your analysis.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">norm_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="va">condition</span>,</span>
<span>                             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CTD"</span>, <span class="st">"RTD"</span>, <span class="st">"ETD"</span>, <span class="st">"ETW"</span>, <span class="st">"ETW2"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">test</span> <span class="op">==</span> <span class="st">"FC"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/basis.html">basis_pooled_cv</a></span><span class="op">(</span><span class="va">strength.norm</span>, <span class="va">condition</span>, <span class="va">batch</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; basis_pooled_cv(data = ., x = strength.norm, groups = condition, </span></span>
<span><span class="co">#&gt;     batch = batch)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Distribution:  Normal - Pooled CV    ( n = 91, r = 5 )</span></span>
<span><span class="co">#&gt; B-Basis:   ( p = 0.9 , conf = 0.95 )</span></span>
<span><span class="co">#&gt; CTD   85.09241 </span></span>
<span><span class="co">#&gt; RTD   78.2274 </span></span>
<span><span class="co">#&gt; ETD   66.55109 </span></span>
<span><span class="co">#&gt; ETW   51.43626 </span></span>
<span><span class="co">#&gt; ETW2  45.81318</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="equivalency">Equivalency<a class="anchor" aria-label="anchor" href="#equivalency"></a>
</h2>
<p>Eventually, once you’ve finished calculating all your basis values,
you’ll probably want to set specification requirements or evaluate
site/process equivalency. <code>cmstatr</code> has functionality to do
both.</p>
<p>Let’s say that you want to develop specification limits for fill
compression that you’re going to put in your material specification. You
can do this as follows:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">carbon.fabric.2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">test</span> <span class="op">==</span> <span class="st">"FC"</span> <span class="op">&amp;</span> <span class="va">condition</span> <span class="op">==</span> <span class="st">"RTD"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/equiv_mean_extremum.html">equiv_mean_extremum</a></span><span class="op">(</span><span class="va">strength</span>, n_sample <span class="op">=</span> <span class="fl">5</span>, alpha <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; equiv_mean_extremum(df_qual = ., data_qual = strength, n_sample = 5, </span></span>
<span><span class="co">#&gt;     alpha = 0.01)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; For alpha = 0.01 and n = 5 </span></span>
<span><span class="co">#&gt; ( k1 = 3.071482 and k2 = 1.142506 )</span></span>
<span><span class="co">#&gt;                   Min Individual    Sample Mean    </span></span>
<span><span class="co">#&gt;      Thresholds:     69.89842         82.16867</span></span></code></pre></div>
<p>If you’re determining equivalency limits for modulus, a different
approach is generally used so that bilateral limits are set.
<code>cmstatr</code> can do this as well, using the function
<code>equiv_change_mean</code>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://www.kloppenborg.ca" class="external-link">Stefan Kloppenborg</a>, Comtek Advanced Structures, Ltd..</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
